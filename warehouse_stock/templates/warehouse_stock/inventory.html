<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>B√°o C√°o T·ªìn Kho</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">
    <h1 class="text-success mb-4">üì¶ B√°o C√°o T·ªìn Kho Nguy√™n V·∫≠t Li·ªáu</h1>
    
    <div class="mb-3">
        <input type="text" id="search-box" class="form-control" placeholder="üîç T√¨m ki·∫øm v·∫≠t t∆∞..." onkeyup="filterTable()">
    </div>

    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>M√£ VT</th>
                <th>T√™n V·∫≠t T∆∞</th>
                <th class="text-end">T·ªìn Kho</th>
                <th>ƒê∆°n V·ªã</th>
                <th>C·∫≠p nh·∫≠t cu·ªëi</th>
            </tr>
        </thead>
        <tbody id="inventory-body">
            </tbody>
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            taiDuLieuTonKho();
        });

        function taiDuLieuTonKho() {
            fetch('/api/inventory/')
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('inventory-body');
                    tbody.innerHTML = '';
                    
                    data.forEach(item => {
                        // Logic ƒë·ªïi m√†u n·∫øu t·ªìn kho th·∫•p (VD: < 1000)
                        const colorClass = item.quantity_on_hand < 1000 ? 'text-danger fw-bold' : '';
                        
                        const row = `
                            <tr>
                                <td>${item.material_code}</td>
                                <td>${item.material_name}</td>
                                <td class="text-end ${colorClass}">${formatNumber(item.quantity_on_hand)}</td>
                                <td>${item.unit}</td>
                                <td>${new Date(item.last_updated).toLocaleString('vi-VN')}</td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });
                })
                .catch(err => console.error(err));
        }

        // H√†m ƒë·ªãnh d·∫°ng s·ªë cho ƒë·∫πp (1000 -> 1,000)
        function formatNumber(num) {
            return parseFloat(num).toLocaleString('vi-VN');
        }

        // H√†m t√¨m ki·∫øm ƒë∆°n gi·∫£n
        function filterTable() {
            const input = document.getElementById("search-box");
            const filter = input.value.toUpperCase();
            const table = document.querySelector("table");
            const tr = table.getElementsByTagName("tr");

            for (let i = 1; i < tr.length; i++) { // B·ªè qua header
                const tdName = tr[i].getElementsByTagName("td")[1]; // C·ªôt T√™n
                const tdCode = tr[i].getElementsByTagName("td")[0]; // C·ªôt M√£
                if (tdName || tdCode) {
                    const txtValue = (tdName.textContent + tdCode.textContent).toUpperCase();
                    tr[i].style.display = txtValue.indexOf(filter) > -1 ? "" : "none";
                }
            }
        }
    </script>
</body>
</html>